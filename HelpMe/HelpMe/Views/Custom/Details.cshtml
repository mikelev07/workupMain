@using Microsoft.AspNet.Identity
@using HelpMe.Helpers
@model HelpMe.Models.CustomViewModel

@{ 
    int maxCustomPrice = HelpMe.Helpers.HtmlExtensions.GetMaxCustomPrice();
}

<div class="single-page-header" data-background-image="images/single-task.jpg">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="single-page-header-inner">
                    <div class="left-side">
                        <div class="avatar-wrapper" data-tippy-placement="bottom" title="@Model.TypeTask.Name">
                            @*<a href="single-company-profile.html">
                                    <img src="@Model.TypeTask.ImagePath" alt="@Model.TypeTask.Name" />
                                </a>*@
                            <img class="profile-pic" src="@Url.Content(Model.TypeTask.ImagePath)" alt="@Model.TypeTask.Name" />
                        </div>
                        <div class="header-details">

                            <h3>@Html.DisplayFor(model => model.Name)</h3>
                            <h5>@Html.DisplayFor(model => model.CategoryTask.Name)</h5>
                            <h5>@Html.DisplayFor(model => model.Skill.Name)</h5>
                            <ul style="margin-top:5px">
                                <li><a href="@Url.Action("Details", "User", new { userName = Model.User.UserName })"><i class="icon-material-outline-face"></i>@Html.DisplayFor(model => model.User.UserName)</a></li>
                                @*<li><div class="verified-badge-with-title">Проверенный заказчик</div></li>*@
                            </ul>
                            <div id="custom-status" class="task-tags" style="margin:0">
                                <span>@HtmlExtensions.EnumDisplayNameFor(Model.Status)</span>
                            </div>

                        </div>
                    </div>
                    <div class="right-side">
                        <div class="salary-box">

                            <div class="salary-type">Бюджет задания</div>
                            <div style="@(Model.Price != null ? "" : "font-size: 20px;")" class="salary-amount">@(Model.Price != null ? Model.Price + "руб." : "По договоренности")</div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-xl-8 col-lg-8 content-right-offset">
            <div class="single-page-section">
                <h3 class="margin-bottom-25">Описание задачи</h3>
                <p style="-moz-hyphens: auto;-webkit-hyphens: auto;-ms-hyphens: auto; word-break:break-word;">
                    <em>@Html.Nl2Br(Model.Description)</em>
                </p>
            </div>



            <div style="margin-bottom: 30px;" class="single-page-section">
                @{
                    string nameOfCustomerSection = "";
                    if (Model.UserId == User.Identity.GetUserId())
                    {
                        nameOfCustomerSection = "Ваши файлы заданий";
                    }
                    else
                    {
                        nameOfCustomerSection = "Вложения заказчика";
                    }
                }
                <h3>@nameOfCustomerSection <span style="color: white" class="nav-tag" id="Myattaches">@Model.MyAttachments.Count </span></h3>

                @if (Request.IsAuthenticated && Model.UserId == User.Identity.GetUserId() && Model.Status != HelpMe.Models.CustomStatus.Close)
                {

                    if (Model.UserId == User.Identity.GetUserId() && Request.IsAuthenticated)
                    {
                        <form method="post" action="/Custom/UploadTestMultiMyAttach/@Model.Id" enctype="multipart/form-data" novalidate="" class="box has-advanced-upload">
                            <div class="box__input">
                                <svg class="box__icon" xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43"><path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"></path></svg>

                                <div style="justify-content:center" class="uploadButton">
                                    <input class="uploadButton-input box__file" type="file" id="file" name="upload" data-multiple-caption="{count} файлов выбрано" multiple="multiple" /><br />
                                    <label id="textLab" class="uploadButton-button ripple-effect" for="file">Прикрепить вложения</label><span style="margin-left:15px;margin-top:6px; font-size:18px" class="box__dragndrop"> или перетащите файлы сюда</span>.
                                </div>
                                <button type="submit" class="box__button">Загрузить</button>
                            </div>
                            <div style="margin-bottom:40px" class="box__uploading"><p>Загружаем вложения</p><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>
                            <div class="box__success">Успешно! <a href="//?" class="box__restart" role="button">Загрузить еще?</a></div>
                            <div class="box__error">Ошибка загрузки! <span></span>. <a href="//?" class="box__restart" role="button">Попробовать снова!</a></div>
                            <input type="hidden" name="ajax" value="1">
                        </form>

                        @*
                            <div>
                                <div class="uploadButton margin-top-30">
                                    <input type="hidden" name="CustomViewModelId" id="CustomViewModelId" value="@Model.Id" />
                                    <input class="uploadButton-input" type="file" name="upload" id="uploadFile" /><br />
                                    <label class="uploadButton-button ripple-effect" for="uploadFile">Прикрепить вложение</label>
                                    <span class="uploadButton-file-name">Загрузите файл вложения любого формата</span>
                                </div>
                                <div class="progress"></div>

                                <input id="submitAttach" type="submit" value="Загрузить" class="button ripple-effect margin-top-10" />
                            </div>*@
                    }


                }
                <br />
                <div id="getAr"></div>
                @if (Request.IsAuthenticated && Model.MyAttachments.Count() > 0)
                {
                    <a style="margin-bottom:20px" id="getArch"
                       class="button gray ripple-effect button-sliding-icon"
                       href="@Url.Action("GetArchive", "Custom", new { id = Model.Id })">Скачать все архивом<i class="icon-feather-arrow-down"></i></a>
                }

                <div id="Uploaded_Results_My" class="attachments-container">
                    @foreach (var i in Model.MyAttachments)
                    {
                        <a class="attachment-box ripple-effect" href="@Url.Action("GetFile", "Custom", new { path = i.AttachFilePath })"><span>@i.AttachFileName</span><i>@i.AttachFileExtens.TrimStart('.')</i></a>
                    }
                </div>

            </div>
            <br />
            @if ((Model.ExecutorId == User.Identity.GetUserId() || Model.UserId == User.Identity.GetUserId()) && Request.IsAuthenticated && !new[] {HelpMe.Models.CustomStatus.Open, HelpMe.Models.CustomStatus.Cancelled}.Contains(Model.Status))
            {
                <div style="margin-bottom: 30px;" class="single-page-section">
                    <h3>Готовые решения исполнителя<span style="color: white" class="nav-tag" id="MainAttaches">@Model.MainAttachments.Count </span></h3>

                    @if (Request.IsAuthenticated && Model.ExecutorId == User.Identity.GetUserId() && (Model.IsRevision == false && Model.Status != HelpMe.Models.CustomStatus.Close))
                    {
                        <form method="post" action="/Custom/UploadTestMultiAttach/@Model.Id" enctype="multipart/form-data" novalidate="" class="box has-advanced-upload">
                            <div class="box__input">
                                <svg class="box__icon" xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43"><path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"></path></svg>

                                <div style="justify-content:center" class="uploadButton">
                                    <input class="uploadButton-input box__file" type="file" id="file" name="upload" data-multiple-caption="{count} файлов выбрано" multiple="multiple" /><br />
                                    <label id="textLab" class="uploadButton-button ripple-effect" for="file">Прикрепить решения</label><span style="margin-left:15px;margin-top:6px; font-size:18px" class="box__dragndrop"> или перетащите файлы сюда</span>.
                                </div>
                                <button type="submit" class="box__button">Загрузить</button>
                            </div>
                            <div style="margin-bottom:40px" class="box__uploading"><p>Загружаем решения</p><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>
                            <div class="box__success">Успешно! <a href="//?" class="box__restart" role="button">Загрузить еще?</a></div>
                            <div class="box__error">Ошибка загрузки! <span></span>. <a href="//?" class="box__restart" role="button">Попробовать снова!</a></div>
                            <input type="hidden" name="ajax" value="1">
                        </form>
                    }
                    <br />
                    <div id="Uploaded_Results_Main" class="attachments-container">
                        <div class="attachments-container">

                            @foreach (var i in Model.MainAttachments)
                            {
                                <div style="margin-bottom:20px; margin-right:14px">
                                    @if (Model.ExecutorId == User.Identity.GetUserId() && Request.IsAuthenticated)
                                    {
                                        <a class="attachment-box ripple-effect" href="@Url.Action("GetFile", "Custom", new { path = i.AttachFilePath })"><span style="width:152px">@i.AttachFileName</span><i>@i.AttachFileExtens.TrimStart('.')</i></a>
                                    }
                                    else
                                    {
                                        string attachPath = i.AttachFilePath.Replace("\\", "\\\\");
                                        <a id="download-main-by-customer" class="attachment-box ripple-effect" onclick="DownloadMainAttachmentByCustomer(@i.Id,@Model.Id, '@attachPath')"><span style="width:152px">@i.AttachFileName</span><i>@i.AttachFileExtens.TrimStart('.')</i></a>
                                    }
                                    @if (i.CustomViewModel.ExecutorId == User.Identity.GetUserId() && (Model.IsRevision == false && Model.Status != HelpMe.Models.CustomStatus.Close))
                                    {
                                        @Ajax.RawActionLink("<i id='fDelMain" + @i.Id + "' class='icon-feather-trash-2'></i><div id='ldsDelMainAttach" + i.Id + "' style='display:none' class='lds-ring'><div></div><div></div><div></div><div></div></div>", "DeleteMainAttach", "Custom",
                                                new { id = i.Id },
                                                new AjaxOptions { OnBegin = "return ConfirmDone()", HttpMethod = "POST", OnSuccess = "OnSuccessDeleteMainAttach('" + @i.Id + "')" },
                                                new
                                                {
                                                    id = "delete-attach",
                                                    @class = "button green ripple-effect ico",
                                                    @style = "margin-left:5px; padding: 3px 5px 3px 3px; ",
                                                    title = "Удалить решение",
                                                    data_tippy_placement = "top"
                                                }
                                                )
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
            <br />
            @if (Model.ExecutorId != null && (Model.ExecutorId == User.Identity.GetUserId() || Model.UserId == User.Identity.GetUserId()))
            {
                <div class="single-page-section" style="margin-bottom:0">
                    <h3>Доработки исполнителя <span style="color: white" class="nav-tag" id="revisions">@Model.Attachments.Count </span></h3>
                    @if (Request.IsAuthenticated && Model.ExecutorId == User.Identity.GetUserId() && Model.IsRevision == true)
                    {
                        <div class="accordion js-accordion">

                            <!-- Accordion Item -->
                            <div class="accordion__item js-accordion-item">
                                <div class="accordion-header js-accordion-header">
                                    <span id="textAttach">Добавить доработку</span>
                                    <div style="left:50%" class="lds-ring"><div></div><div></div><div></div><div></div></div>

                                </div>

                                <!-- Accordtion Body -->
                                <div id="accordBody" class="accordion-body js-accordion-body">

                                    <!-- Accordion Content -->
                                    <div class="accordion-body__contents">
                                        <div style="margin-bottom:0px;" class="single-page-section">
                                            @if (Model.ExecutorId == User.Identity.GetUserId() && Request.IsAuthenticated)
                                            {
                                                <h3>Добавление файла доработки</h3>
                                                <div>
                                                    <div class="uploadButton margin-top-30">
                                                        <input type="hidden" name="CustomViewModelId" id="CustomViewModelId" value="@Model.Id" />
                                                        <input class="uploadButton-input" type="file" name="upload" id="uploadFile" /><br />
                                                        <label class="uploadButton-button ripple-effect" for="uploadFile">Прикрепить решение</label>
                                                        <span class="uploadButton-file-name">Загрузите файл решения для исполнителя любого формата</span>
                                                    </div>
                                                    <div class="progress"></div>
                                                    <div class="section-headline margin-top-25 margin-bottom-12">
                                                        <h5>Укажите цену решения</h5>
                                                    </div>
                                                    <div class="input-with-icon-left no-border">
                                                        <i class="icon-material-outline-local-atm"></i>
                                                        <input style="width:250px" name="ExecutorPrice" id="ExecutorPrice"
                                                               type="number" min="0" max="@maxCustomPrice" step="1" class="input-text no-spinners"
                                                               oninput="validity.valid||(value='');" placeholder="Цена">
                                                        <div class="checkbox">
                                                            <input type="checkbox" id="checkbox1" autocomplete="off">
                                                            <label for="checkbox1"><span class="checkbox-icon"></span>Бесплатная доработка</label>
                                                        </div>
                                                    </div>
                                                    <input id="add-revision" type="submit" value="Загрузить" class="button ripple-effect margin-top-10" />
                                                </div>
                                            }

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    <br />
                    <div id="Uploaded_Revisions">
                        <div style="margin-bottom:35px;" id="itemAttach">
                            <div class="attachments-container">
                                @{ var idnew = 1; }
                                @foreach (var i in Model.Attachments)
                                {
                                    <div style="margin-bottom:20px; margin-right:16px">
                                        <a style='@(i.AttachStatus != HelpMe.Models.AttachStatus.NotPurchased || Model.ExecutorId == User.Identity.GetUserId() ? "" : "pointer-events: none;")'
                                           href="@Url.Action("GetFileAttach", "Custom", new { path = i.AttachFilePath, id = i.Id })"
                                           class="attachment-box ripple-effect "><span style="width:152px">@i.AttachFileName</span><i style="margin-left:40px">@i.ExecutorPrice руб.</i><i style="">@i.AttachFileExtens.TrimStart('.')</i></a>

                                        @if (Model.ExecutorId == User.Identity.GetUserId() && i.AttachStatus == HelpMe.Models.AttachStatus.NotPurchased)
                                        {
                                            @Ajax.RawActionLink(
                                                "<i id='fDelbuy" + i.Id + "' class='icon-feather-trash-2'></i><div id='ldsDelAttach" + i.Id + "' style='display:none' class='lds-ring'><div></div><div></div><div></div><div></div></div>", "DeleteAttach", "Custom",
                                                new { id = i.Id },

                                                new AjaxOptions { OnBegin = "return ConfirmDone()", HttpMethod = "POST", OnSuccess = "OnSuccessDeleteAttach('" + @i.Id + "')" },
                                                new
                                                     {
                                                    id = "delete-attach",
                                                    @class = "button green ripple-effect ico",
                                                    @style = "    padding: 3px 5px 3px 3px; ",
                                                    title = "Удалить решение",
                                                    data_tippy_placement = "top"
                                                })

                                            @*@Ajax.RawActionLink(
                                                "<i  id='fDelbuy" + i.Id + "' class='icon-feather-edit'></i><div id='ldsDelAttach" + i.Id + "' style='display:none' class='lds-ring'><div></div><div></div><div></div><div></div></div>", "DeleteAttach", "Custom",
                                                new { id = i.Id },
                                                new AjaxOptions { OnBegin = "return ConfirmDone()", HttpMethod = "POST", OnSuccess = "OnSuccessDeleteAttach('" + @i.Id + "')" },
                                                new
                                                     {
                                                    id = "delete-attach",
                                                    @class = "button  ripple-effect ico",
                                                    @style = "  margin-left:5px;  padding: 3px 5px 3px 3px; ",
                                                    title = "Удалить решение",
                                                    data_tippy_placement = "top"
                                                })*@
                                        }

                                        @if (Model.UserId == User.Identity.GetUserId())
                                        {
                                            if (i.AttachStatus == HelpMe.Models.AttachStatus.NotPurchased)
                                            {
                                                @Ajax.RawActionLink(
                                               "<i id='fbuy" + i.Id + "' style='margin-top: -10px;' class='icon-material-outline-monetization-on'></i><span id='textAttachBuy" + i.Id + "'>Купить</span><div id='ldsAttach" + i.Id + "' style='display:none' class='lds-ring'><div></div><div></div><div></div><div></div></div>", "Buy", "Custom",
                                               new { id = i.Id },

                                               new AjaxOptions { OnBegin = "return OnBeginBuyAttach('" + @i.Id + "')", OnSuccess = "return OnSuccessBuyAttach('" + @i.Id + "')", HttpMethod = "POST" },
                                               new
                                                    {
                                                   id = "buy-solution",
                                                   @class = "button ripple-effect",
                                                   @style = (i.AttachStatus == HelpMe.Models.AttachStatus.Purchased ? "display:; margin-top: -5px;" : "    margin-top: -5px;"),
                                                   title = "Купить решение",
                                                   data_tippy_placement = "top"
                                               }
                                               )
                                            }
                                            else
                                            {
                                                <div style='margin-top: -10px;' class="task-tags margin-bottom-20">
                                                    <span>Работа куплена</span>
                                                </div>

                                            }
                                        }
                                        @if (Model.ExecutorId == User.Identity.GetUserId())
                                        {
                                            if (i.AttachStatus != HelpMe.Models.AttachStatus.NotPurchased)
                                            {
                                                <div style='margin-top: -10px;' class="task-tags ">
                                                    <span>Работа куплена</span>
                                                </div>
                                            }
                                        }
                                    </div>
                                    idnew = idnew + 1;
                                }
                            </div>
                        </div>


                    </div>


                </div>
            }

            @*<div class="single-page-section">
                    <h3>Необходимые навыки</h3>
                    <div class="task-tags">
                        <span>iOS</span>
                        <span>Android</span>
                        <span>mobile apps</span>
                        <span>design</span>
                    </div>
                </div>*@
            <div class="clearfix"></div>

            <div class="boxed-list margin-bottom-60">
                <div class="boxed-list-headline" id="executors-offers">
                    <h3>
                        <i class="icon-material-outline-group"></i>
                        <span>Предложения исполнителей  </span>
                        <span style="color:white" class="nav-tag" id="votes">@Model.Comments.Count </span>
                        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
                        @if (Model.UserId == User.Identity.GetUserId() && Model.Comments.Count() > 0)
                        {
                            <div class="sort-by">
                                <span>Сортировать по:</span>
                                <select class="selectpicker hide-tick" id="sortComments" autocomplete="off">
                                    <option value="1" selected>Новым</option>
                                    <option value="2">Давним</option>
                                    <option value="3">Рейтингу</option>
                                    <option value="4">Дешевым</option>
                                    <option value="5">Дорогим</option>
                                </select>
                            </div>
                        }
                    </h3>
                </div>


                <ul class="boxed-list-ul" id="boxed-list-ul">
                    @foreach (var c in Model.Comments.Reverse())
                    {
                        if (Model.UserId == User.Identity.GetUserId() || c.UserId == User.Identity.GetUserId())
                        {
                            <li id="user-comment-@c.Id" class="comments">
                                <div class="bid">
                                    <div class="bids-avatar">
                                        <div class="freelancer-avatar">
                                            @*<div class="verified-badge"></div>*@
                                            <a href="@Url.Action("Details", "User", new { userName = c.User.UserName })">
                                                <img src="@(Url.Content(c.User.ImagePath ?? "~/Content/Custom/images/user-avatar-big-01.jpg"))" alt="аватар">
                                            </a>
                                        </div>
                                    </div>

                                    <div class="bids-content">
                                        <!-- Name -->
                                        <div class="freelancer-name">
                                            <h4 style="margin-bottom:0">
                                                <a href="@Url.Action("Details", "User", new { userName = c.User.UserName })">
                                                    @c.User.UserName  <h6 class="custom-comments">@c.CreationDate.ToString("dd MMMM yyyy HH:mm:ss")</h6>@*| @c.Id*@
                                                    @*<img class="flag" src="images/flags/gb.svg" alt="" title="United Kingdom" data-tippy-placement="top">*@
                                                </a>
                                            </h4>
                                            @{
                                                var likes = c.User.PositiveThumbs;
                                                var dislikes = c.User.NegativeThumbs;
                                                var rate = "0.0";
                                                if (likes + dislikes > 0)
                                                {
                                                    rate = Math.Round((double)likes / (likes + dislikes) * 5, 1).ToString().Replace(',', '.');
                                                }
                                                if (rate.Length == 1)
                                                {
                                                    rate = rate + ".0";
                                                }
                                            }
                                            <div class="star-rating" data-rating="@rate"></div>
                                        </div>
                                    </div>

                                    <!-- Bid -->
                                    <div class="bids-bid">
                                        <div class="bid-rate" id="user-comment-bid-rate-@c.Id">
                                            <div class="rate">@c.OfferPrice рублей</div>
                                            @if (c.Days > 0)
                                            {
                                                <span>за @c.Days дней</span>
                                            }
                                            else
                                            {
                                                <span>за @c.Hours часов</span>
                                            }
                                        </div>
                                        @if (Model.ExecutorId != User.Identity.GetUserId() && Model.UserId != User.Identity.GetUserId() && Model.ExecutorId == null)
                                        {
                                            <div style="margin-left: 23px;" class="buttons-to - right always - visible">
                                                <a href="#small-dialog" class="popup-with-zoom-anim button dark ripple-effect ico" title="Редактировать" data-tippy-placement="top">
                                                    <i class="icon-feather-edit"></i>
                                                </a>
                                                <a href="#small-dialog-3" id="checkEx" class="popup-with-zoom-anim button red ripple-effect ico" title="Удалить" data-tippy-placement="top">
                                                    <i class="icon-feather-trash-2"></i>
                                                </a>
                                            </div>
                                        }
                                    </div>
                                </div>
                                @if (Model.UserId == User.Identity.GetUserId() && Model.ExecutorId == null)
                                {
                                    <div class="margin-top-30">
                                        <a href="#small-dialog-1-@c.Id" style="box-shadow: 0 12px 12px rgba(0,0,0,0.1);border-radius: 25px;" class="popup-with-zoom-anim button ripple-effect"><i class="icon-material-outline-check"></i> Принять предложение</a>
                                        <a href="#small-dialog-2-@c.Id" style="background-color: #f4f4f4;box-shadow: 0 12px 12px rgba(0,0,0,0.1);color: #333;border-radius: 25px;" class="popup-with-zoom-anim button dark ripple-effect"><i class="icon-feather-mail"></i> Отправить сообщение</a>
                                    </div>
                                }
                                <div class="item-description margin-top-20">
                                    <p style="word-break:break-word;"> @c.Description</p>
                                </div>
                            </li>

                            {
                                if (Model.Comments.Where(m => m.UserId == User.Identity.GetUserId()).Count() > 0)
                                {
                                    var updateTargetIdEdit = "user-comment-bid-rate-" + c.Id;
                                    //var updateTargetIdDelete = "user-comment-" + c.Id;

                                    <div id="small-dialog" class="zoom-anim-dialog mfp-hide dialog-with-tabs">


                                        <div class="sign-in-form">

                                            <ul class="popup-tabs-nav">
                                                <li><a href="#tab">Редактировать предложение</a></li>
                                            </ul>
                                            <div class="popup-tabs-container">

                                                <!-- Tab -->
                                                <div class="popup-tab-content" id="tab">

                                                    @using (Ajax.BeginForm("EditComment", new { Id = c.Id }, new AjaxOptions
                                                    {
                                                        UpdateTargetId = updateTargetIdEdit,
                                                        InsertionMode = InsertionMode.Replace,
                                                        OnBegin = "return OnBeginEditComment()",
                                                        OnSuccess = "return OnSuccessEditComment(" + c.Id + ")"
                                                    }))
                                                    {
                                                        @Html.AntiForgeryToken()

                                                        @*@Html.Hidden("Id", c.Id.ToString())*@
                                                        @Html.Hidden("UserId", c.UserId.ToString())
                                                        @Html.Hidden("CustomViewModelId", c.CustomViewModelId.ToString())
                                                        @Html.Hidden("CreationDate", c.CreationDate.ToString())

                                                        var timeCount = c.Days;
                                                        string nameTime = "Days";
                                                        if (timeCount == 0)
                                                        {
                                                            nameTime = "Hours";
                                                            timeCount = c.Hours;
                                                        }

                                                        <!-- Bidding -->
                                                        <div class="bidding-widget">
                                                            <!-- Headline -->
                                                            <span class="bidding-detail">Укажите <strong>стоимость работы:</strong> </span>

                                                            <!-- Price Slider -->
                                                            <div class="bidding-value">
                                                                <span id="edit-comment-bidding-value"></span> руб. <button type="button" id="edit-comment-show-price"><i title="Редактировать" data-tippy-placement="top" style="color:green" class="icon-line-awesome-pencil"></i></button>
                                                                <input id="edit-comment-price-value" name="OfferPrice" class="no-spinners" style="margin-bottom:5px; display:none"
                                                                       placeholder="Укажите стоимость" type="number" value="0"
                                                                       oninput="validity.valid||(value='');" min="0" max="@maxCustomPrice"
                                                                       data-tippy-placement="top" />
                                                            </div>

                                                            <input id="edit-comment-slider-price" class="bidding-slider" type="text" value="@Model.Price"
                                                                   data-slider-handle="custom" data-slider-currency="$" data-slider-min="0"
                                                                   data-slider-max="@maxCustomPrice" data-slider-value="@Model.Price" data-slider-step="50"
                                                                   data-slider-tooltip="hide" />

                                                            <!-- Headline -->
                                                            <span class="bidding-detail margin-top-10">Укажите <strong>срок выполнения:</strong></span>

                                                            <!-- Fields -->
                                                            <div class="bidding-fields">
                                                                <div class="bidding-field">

                                                                    <!-- Quantity Buttons -->
                                                                    <div class="qtyButtons with-border">
                                                                        <div class="qtyDec"></div>
                                                                        <input id="edit-comment-time" class="no-spinners" type="number" min="1" max="100"
                                                                               step="1" name="@nameTime" value="@timeCount" oninput="validity.valid||(value='');">
                                                                        <div class="qtyInc"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="bidding-field">
                                                                    <select class="selectpicker default with-border" id="edit-time-units">
                                                                        @if (nameTime == "Days")
                                                                        {
                                                                            <option selected value="1">дней</option>
                                                                            <option value="2">часов</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="1">дней</option>
                                                                            <option selected value="2">часов</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Headline -->
                                                        <span class="bidding-detail margin-top-10">Добавьте <strong>комментарий:</strong></span>

                                                        <textarea id="edit-comment-desсription" name="Description" cols="30" rows="5" class="with-border" maxlength="200" placeholder="Оставьте своё предложение для заказчика...">@c.Description</textarea>
                                                        //Для проверки
                                                        @*<div>commentId=@c.Id</div>
                                                            <div>description=@c.Description</div>*@


                                                        <!-- Button -->
                                                        <button class="button full-width button-sliding-icon ripple-effect" type="submit">Сохранить <i class="icon-material-outline-arrow-right-alt"></i></button>
                                                    }
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div id="small-dialog-3" class="zoom-anim-dialog mfp-hide dialog-with-tabs">
                                        <div class="sign-in-form">
                                            <ul class="popup-tabs-nav">
                                                <li><a href="#tab">Удалить предложение</a></li>
                                            </ul>

                                            <div class="popup-tabs-container">

                                                <!-- Tab -->
                                                <div class="popup-tab-content" id="tab">

                                                    @*@Html.AntiForgeryToken()*@
                                                    <div class="bidding-widget">
                                                        <!-- Headline -->
                                                        <div class="form-actions no-color">
                                                            <span class="bidding-detail margin-top-30">Действительно хотите удалить предложение?</span>
                                                        </div>
                                                    </div>

                                                    <!-- Button -->
                                                    <button id="delete-comment-button" class="button full-width button-sliding-icon ripple-effect"
                                                            type="submit" onclick="return OnClickDeleteComment(@c.Id)">
                                                        Подтвердить <i class="icon-material-outline-arrow-right-alt"></i>
                                                    </button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                }
                            }

                            <div id="small-dialog-1-@c.Id" class="small-dialog-1 zoom-anim-dialog mfp-hide dialog-with-tabs">

                                <!--Tabs -->
                                <div class="sign-in-form">

                                    <ul class="popup-tabs-nav">
                                        <li><a href="#tab1">Принять предложение</a></li>
                                    </ul>

                                    <div class="popup-tabs-container">

                                        <!-- Tab -->
                                        <div class="popup-tab-content" id="tab">

                                            <!-- Welcome Text -->
                                            <div class="welcome-text">
                                                <h3>Принять предложение от @c.User.UserName?</h3>
                                                <div class="bid-acceptance margin-top-15">
                                                    <div class="bid-rate" id="user-comment-bid-rate-@c.Id">
                                                        <div class="rate">@c.OfferPrice рублей</div>
                                                        @if (c.Days > 0)
                                                        {
                                                            <span>за @c.Days дней</span>
                                                        }
                                                        else
                                                        {
                                                            <span>за @c.Hours часов</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>

                                            @using (Html.BeginForm("ChooseExecutor", "Custom", new { CustId = c.Id }))
                                            {
                                                <div class="radio">
                                                    <input id="radio-choose-executor-@c.UserId" name="radio" type="radio" required autocomplete="off"
                                                           oninvalid="setCustomValidity('Сперва нужно ознакомиться с правилами!')"
                                                           oninput="setCustomValidity('')" />
                                                    <label for="radio-choose-executor-@c.UserId"><span class="radio-label"></span>  Я ознакомился с правилами</label>
                                                </div>
                                                if (ViewBag.WalletSumm >= c.OfferPrice)
                                                {
                                                    <input id="choose-executor-@c.UserId" class="margin-top-15 button full-width button-sliding-icon ripple-effect"
                                                           type="submit" value="Принять" />
                                                }
                                                else
                                                {
                                                    int exSum = c.OfferPrice - ViewBag.WalletSumm;

                                                    <a href="/Wallet/AddSumm?summ=@exSum&returnUrl=@Request.Url.ToString()" style="color:white" class="margin-top-15 button full-width button-sliding-icon ripple-effect">Пополнить счет на @exSum и принять</a>
                                                }

                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Bid Acceptance Popup / End -->


                            <div id="small-dialog-2-@c.Id" class="small-dialog-2 zoom-anim-dialog mfp-hide dialog-with-tabs">

                                <ul class="popup-tabs-nav">
                                    <li><a href="#tab2">Отправка сообщения</a></li>
                                </ul>
                                <div class="popup-tabs-container">
                                    @using (Html.BeginForm("AddMessage", "Chat", FormMethod.Post, new { target = "_blank" }))
                                    {
                                        @Html.AntiForgeryToken();
                                        <!-- Tab -->

                                        <div class="popup-tab-content" id="tab2">

                                            <!-- Welcome Text -->
                                            <div class="welcome-text">
                                                <h3>Отправьте сообщение @c.User.UserName</h3>
                                            </div>
                                            @Html.Hidden("UserFromId", User.Identity.GetUserId(), new { id = "userFromId-" + c.UserId })
                                            @Html.Hidden("UserToId", c.UserId, new { id = "userToId-" + c.UserId })

                                            <textarea name="Description" id="add-message-description-@c.UserId" cols="10" placeholder="Сообщение" class="with-border"></textarea>
                                            <!-- Button -->
                                            <button class="button margin-top-35 full-width button-sliding-icon ripple-effect" type="submit">Отправить <i class="icon-material-outline-arrow-right-alt"></i></button>
                                        </div>
                                    }

                                </div>

                                @*<!--Tabs -->
                                    <div class="sign-in-form">

                                        <ul class="popup-tabs-nav">
                                            <li><a href="#tab2">Отправка сообщения</a></li>
                                        </ul>

                                        <div class="popup-tabs-container">

                                            <!-- Tab -->
                                            <div class="popup-tab-content" id="tab2">

                                                <!-- Welcome Text -->
                                                <div class="welcome-text">
                                                    <h3>Отправить сообщение @c.User.UserName</h3>
                                                </div>

                                                <!-- Form -->
                                                <form method="post" id="send-pm">
                                                    <textarea name="textarea" cols="10" placeholder="Оставьте сообщение..." class="with-border" required></textarea>
                                                </form>

                                                <!-- Button -->
                                                <a class="button full-width button-sliding-icon ripple-effect" type="submit" form="send-pm" target="_blank">Отправить <i class="icon-material-outline-arrow-right-alt"></i></a>

                                            </div>

                                        </div>
                                    </div>*@
                            </div>

                        }
                    }
                    <!--End of foreach-->

                </ul>
            </div>
        </div>


        @if (Request.IsAuthenticated && Model.UserId == User.Identity.GetUserId() && Model.ExecutorId != null)
        {
            if (Model.Status == HelpMe.Models.CustomStatus.Check || Model.Status == HelpMe.Models.CustomStatus.Revision)
            {
                <div id="small-dialog-3" class="zoom-anim-dialog mfp-hide dialog-with-tabs">

                    <!--Tabs -->
                    <div class="sign-in-form">

                        <ul class="popup-tabs-nav">
                            <li><a href="#tab1">Отклонить исполнителя</a></li>
                        </ul>

                        <div class="popup-tabs-container">

                            <!-- Tab -->
                            <div class="popup-tab-content" id="tab">

                                <!-- Welcome Text -->
                                <div class="welcome-text">
                                    <h3>Вы уверены, что хотите отказаться от услуг исполнителя @Model.Executor.UserName? </h3>
                                </div>

                                <div class="radio">
                                    <input id="radio-reject-executor" name="radio" type="radio" required autocomplete="off"
                                           oninvalid="setCustomValidity('Сперва нужно ознакомиться с правилами!')"
                                           oninput="setCustomValidity('')" />
                                    <label for="radio-reject-executor"><span class="radio-label"></span>  Я ознакомился с правилами</label>
                                </div>
                                <input id="reject-executor" class="margin-top-15 button full-width button-sliding-icon ripple-effect"
                                       type="button" value="Подтвердить" />

                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <!-- Leave a Review Popup
                ================================================== -->
                <div id="small-dialog-4" class="zoom-anim-dialog mfp-hide dialog-with-tabs">

                    <!--Tabs -->
                    <div class="sign-in-form">

                        <ul class="popup-tabs-nav">
                            <li><a href="#tab">Подтвердите выполнение и оставьте отзыв</a></li>
                        </ul>

                        <div class="popup-tabs-container">

                            <!-- Tab -->
                            <div class="popup-tab-content" id="tab">

                                @using (Html.BeginForm("Accept", "Custom", new { id = Model.Id }))
                                {
                                    @Html.AntiForgeryToken() <!-- Welcome Text -->
                                    <div class="welcome-text">
                                        <h3>Оцените исполнителя @Model.Executor.UserName:</h3>

                                        <!-- Form -->
                                        <!-- Leave Rating -->
                                        <div class="clearfix"></div>
                                        <div class="leave-rating-container">
                                            <div class="leave-rating margin-bottom-5">
                                                <input type="radio" name="Rating" id="rating-1" value="5" required>
                                                <label for="rating-1" class="icon-material-outline-star"></label>
                                                <input type="radio" name="Rating" id="rating-2" value="4" required>
                                                <label for="rating-2" class="icon-material-outline-star"></label>
                                                <input type="radio" name="Rating" id="rating-3" value="3" required>
                                                <label for="rating-3" class="icon-material-outline-star"></label>
                                                <input type="radio" name="Rating" id="rating-4" value="2" required>
                                                <label for="rating-4" class="icon-material-outline-star"></label>
                                                <input type="radio" name="Rating" id="rating-5" value="1" required>
                                                <label for="rating-5" class="icon-material-outline-star"></label>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                        <!-- Leave Rating / End-->
                                    </div>
                                    @Html.TextArea("Description", "",
                                   new
                                        {
                                       rows = "5",
                                            cols = "7",
                                       @placeholder = "Оставьте отзыв об исполнителе, которого он заслуживает (по желанию)...",
                                       id = "create-review-description",
                                       @class = "with-border"
                                        })
                                    @Html.Hidden("OwnerId", Model.Executor.Id)
                                    <!-- Button -->
                                    <button class="button margin-top-35 full-width button-sliding-icon ripple-effect" type="submit">Подтвердить выполнение <i class="icon-material-outline-arrow-right-alt"></i></button>
                                }
                            </div>

                        </div>
                    </div>
                </div>
                <!-- Leave a Review Popup / End -->
            }
        }
        @if (Request.IsAuthenticated && Model.UserId == User.Identity.GetUserId() && Model.ExecutorId == null)
        {
            <div id="small-dialog-3" class="zoom-anim-dialog mfp-hide dialog-with-tabs">

                <!--Tabs -->
                <div class="sign-in-form">

                    <ul class="popup-tabs-nav">
                        <li><a href="#tab1">Редактировать заказ</a></li>
                    </ul>

                    <div class="popup-tabs-container">

                        <!-- Tab -->
                        <div class="popup-tab-content" id="tab">

                            @using (Html.BeginForm("Edit", "Custom", FormMethod.Post))
                            {
                                @Html.AntiForgeryToken()
                                @Html.Hidden("Id", Model.Id)
                                @Html.Hidden("UserId", Model.UserId)
                                @Html.Hidden("StartDate", Model.StartDate)
                                @Html.Hidden("ExecutorStartDate", Model.ExecutorStartDate)

                                <!-- Welcome Text -->
                                <!-- Form -->
                                <div class="row">
                                    <!-- Dashboard Box -->
                                    <div style="margin: 0 auto;">
                                        <div class="dashboard-box margin-top-0">

                                            <!-- Headline -->
                                            <div class="headline">
                                                <h3><i class="icon-feather-edit"></i> Редактирование заказа</h3>
                                            </div>


                                            <div class="content with-padding padding-bottom-10">
                                                <div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Название задания</h5>
                                                            @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "with-border", @placeholder = "Название задания" } })
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Дисциплина</h5>
                                                            @Html.DropDownListFor(model => model.CategoryTaskId, ViewBag.Tasks as SelectList,
                                                            "Укажите дисциплину", new { @class = "selectpicker with-border", @id = "TaskList", autocomplete = "off" })
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Предмет</h5>
                                                            @Html.DropDownListFor(model => model.SkillId, Enumerable.Empty<SelectListItem>(),
                                                                "Укажите предмет", new { @class = "selectpicker with-border", id = "SkillList", @disabled = "disabled", autocomplete = "off" })
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Тип задания</h5>
                                                            @Html.DropDownListFor(model => model.TypeTaskId, ViewBag.Types as SelectList, new { @class = "selectpicker with-border" })
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Описание задания</h5>
                                                            @Html.TextAreaFor(model => model.Description, new { rows = "5", cols = "30", @class = "with-border" })

                                                            @*<div class="uploadButton margin-top-30">
                                                                    <input multiple="multiple" class="uploadButton-input" type="file" name="AttachFile" id="AttachFile" required />
                                                                    <label class="uploadButton-button ripple-effect" for="AttachFile">Прикрепить задания</label>
                                                                    <span style="padding-left:10px" class="uploadButton-file">Вы можете прикрепить несколько вложений</span>
                                                                </div>*@
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Дата сдачи задания</h5>
                                                            <div style="display:inline">
                                                                <div class="input-group date" data-provide="datepicker">
                                                                    <div class="input-with-icon-left no-border">
                                                                        <i class="icon-material-outline-date-range"></i>
                                                                        <input id="EndingDate" placeholder="Дата сдачи" name="EndingDate" type="text" class="form-control">
                                                                    </div>
                                                                    <div class="input-group-addon">
                                                                        <span class="glyphicon glyphicon-th"></span>
                                                                    </div>
                                                                </div>
                                                                <h5>Время сдачи</h5>
                                                                <div class="form-group">
                                                                    <div class="input-group">
                                                                        <div class="input-with-icon-left no-border">
                                                                            <i class="icon-material-outline-access-time"></i>
                                                                            <input id="datetimepicker3" placeholder="Время сдачи" type="text" class="form-control" />
                                                                        </div>
                                                                        <span class="input-group-addon">
                                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="checkbox">
                                                                <input type="checkbox" id="checkboxDate">
                                                                <label for="checkboxDate"><span class="checkbox-icon"></span>Срок неизвестен</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="submit-field">
                                                            <h5>Бюджет задания</h5>

                                                            <div class="row">
                                                                <div class="col-xl-8">
                                                                    <div class="input-with-icon">
                                                                        @Html.EditorFor(model => model.Price, new { htmlAttributes = new { @id = "min", @min = "0", @max = maxCustomPrice, @class = "with-border disabled no-spinners", @placeholder = "Цена", @oninput = "validity.valid||(value = '');" } })
                                                                        <i class="currency">Руб.</i>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="checkbox">
                                                                <input type="checkbox" id="checkboxNew">
                                                                <label for="checkboxNew"><span class="checkbox-icon"></span>По договоренности</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @*<div>
                                                            <div class="submit-field">
                                                                <h5>Срок блокировки оплаты</h5>
                                                                <select class="selectpicker-filter">
                                                                    <option>5 дней</option>
                                                                    <option>10 дней</option>
                                                                    <option>15 дней</option>
                                                                    <option>20 дней</option>
                                                                    <option>30 дней</option>
                                                                    <option>40 дней</option>
                                                                </select>
                                                            </div>
                                                        </div>*@
                                                    @*<div>
                                                            <div class="submit-field">
                                                                <h5>Проверка на плагиат</h5>
                                                                <div class="col-xl-6">
                                                                    <select class="selectpicker-filter">
                                                                        <option>40%</option>
                                                                        <option>50%</option>
                                                                        <option>60%</option>
                                                                        <option>70%</option>
                                                                        <option>80%</option>
                                                                        <option>90%</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>*@

                                                    @*<div id="fileUpCreate" style="border-bottom: 1px solid #e4e4e4;">

                                                        </div>*@

                                                    @*<div style="margin-top:20px">
                                                            <div class="submit-field">
                                                                <h5>Платные услуги</h5>

                                                                <select class="selectpicker-filter">
                                                                    <option>40%</option>
                                                                    <option>50%</option>
                                                                    <option>60%</option>
                                                                    <option>70%</option>
                                                                    <option>80%</option>
                                                                    <option>90%</option>
                                                                </select>

                                                            </div>
                                                        </div>*@

                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <input type="submit" value="Подтвердить изменения" class="button ripple-effect margin-top-20" />
                                        </div>
                                    </div>



                                </div>
                            }

                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Spacer -->
        <!-- Sidebar -->
        <div class="col-xl-4 col-lg-4">
            <div class="sidebar-container">
                @{
                    var totalDays = Model.TotalHrs?.Days;
                    var totalHours = Model.TotalHrs?.Hours;

                    if (totalDays == null || totalHours == null)
                    {
                        <div class="countdown green margin-bottom-35">
                            Время завершения не указано
                        </div>
                    }
                    else
                    {
                        if (totalDays < 0)
                        {
                            totalDays = 0;
                        }
                        if (totalHours < 0)
                        {
                            totalHours = 0;
                        }
                        <div style="@(totalDays < 3 ? "color:#de5959; background-color:#ffe9e9" : "")"
                             class="countdown green margin-bottom-35">
                            @(totalDays != 0 && totalHours != 0 ? "До завершения: " + totalDays + " дней и " + totalHours + " часов" : "Время вышло")
                        </div>
                    }

                }

                <!--Sidebar buttons-->
                <div id="buttonsCont" class="buttons-container">
                    @if (Model.UserId == User.Identity.GetUserId())
                    {
                        switch (Model.Status)
                        {
                            case HelpMe.Models.CustomStatus.Open:
                                <a style="margin-bottom:20px" href="#small-dialog-3" class="apply-now-button popup-with-zoom-anim" title="Редактировать параметры задания" data-tippy-placement="bottom">Редактировать заказ <i class="icon-feather-edit"></i></a>
                                <a href="@Url.Action("Cancel", "Custom", new { id = Model.Id })" class="apply-now-button" title="Убрать заказ из списка видимых для исполнителей" data-tippy-placement="bottom">Отменить заказ <i class="icon-material-outline-undo"></i></a>
                                break;

                            case HelpMe.Models.CustomStatus.Cancelled:
                                <a style="margin-bottom:20px" href="#small-dialog-3" class="apply-now-button popup-with-zoom-anim" title="Редактировать параметры задания" data-tippy-placement="bottom">Редактировать заказ <i class="icon-material-outline-info"></i></a>
                                <a href="@Url.Action("Cancel", "Custom", new { id = Model.Id })" class="apply-now-button" title="Вернуть заказ в список видимых для исполнителей" data-tippy-placement="bottom">Переоткрыть заказ <i class="icon-material-outline-redo"></i></a>
                                break;

                            case HelpMe.Models.CustomStatus.Revision:
                            case HelpMe.Models.CustomStatus.Check:
                                <a style="margin-bottom:20px" href="#small-dialog-3" class="apply-now-button popup-with-zoom-anim">Отказаться от исполнителя <i class="icon-material-outline-access-alarm"></i></a>
                                break;

                            case HelpMe.Models.CustomStatus.CheckCustom:
                                <div id="buttonsCont" class="buttons-container">
                                    <a style="margin-bottom:20px" href="#small-dialog-4" class="apply-now-button popup-with-zoom-anim">Подтвердить выполнение <i class="icon-material-outline-check"></i></a>
                                    <a href="@Url.Action("Revision", "Custom", new { id = Model.Id })" class="apply-now-button">Отправить на доработку <i class="icon-material-outline-compare-arrows"></i></a>
                                </div>
                                break;

                            case HelpMe.Models.CustomStatus.Close:
                                <a id="send-for-revision" href="@Url.Action("Revision", "Custom", new { id = Model.Id })" class="apply-now-button">Отправить на доработку <i class="icon-material-outline-compare-arrows"></i></a>
                                break;

                            default:
                                break;
                        }
                    }
                </div>

                <div class="js-accordion sidebar-widget">
                    <div class="job-overview accordion__item js-accordion-item">
                        <div style="color:#333; font-size: 18px;  background-color: #f2f2f2; border-radius: 4px; padding: 20px 35px" class="accordion-header js-accordion-header">
                            <i class="icon-material-outline-info"></i> Краткая информация
                        </div>
                        <div class="job-overview-inner js-accordion-body" style="display:none">

                            <ul class="boxed-list-ul">
                                <li>
                                    <i class="icon-material-outline-date-range"></i>
                                    <h5>Дата создания</h5>
                                    <span>@Model.StartDate.ToString("dd MMMM yyyy HH:mm:ss")</span>
                                </li>
                                <li>
                                    <i class="icon-material-outline-business-center"></i>
                                    <h5>Тип работы</h5>
                                    <span> @Html.DisplayFor(model => model.TypeTask.Name)</span>
                                </li>
                                <li>
                                    <i class="icon-material-outline-access-time"></i>
                                    <h5>Выполнить до</h5>
                                    <span>@((Model.EndingDate?.ToString("dd MMMM yyyy HH:mm:ss")) ?? "дата сдачи не указана")</span>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>

                @if (Model.ExecutorId != null)
                {
                    <div class="sidebar-widget">
                        <div class="job-overview">
                            <div class="job-overview-headline">Исполнитель работы</div>
                            <div class="job-overview-inner">
                                <ul>
                                    <li>
                                        <i class="icon-material-outline-computer"></i>
                                        <h5>Текущий исполнитель</h5>
                                        <span><a href="@Url.Action("Details", "User", new { userName = Model.Executor.UserName })">@Model.Executor.UserName</a></span>
                                    </li>
                                    <li>
                                        <i class="icon-material-outline-money"></i>
                                        <h5>Предложенная цена:</h5>
                                        <span> @Model.ExecutorPrice руб.</span>
                                    </li>
                                    <li>
                                        @{
                                            var executorComment = Model.Comments.Where(c => c.UserId == Model.ExecutorId).FirstOrDefault();
                                            var hours = executorComment.Hours;
                                            var days = executorComment.Days;
                                            var executorDeadLine = Model.ExecutorStartDate?.AddDays(days).AddHours(hours);
                                        }
                                        <i class="icon-material-outline-access-time"></i>
                                        <h5>Выполнит заказ к:</h5>
                                        <span> @(executorDeadLine?.ToString("dd MMMM yyyy HH:mm:ss"))</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                }

                @if (Request.IsAuthenticated && Model.UserId != User.Identity.GetUserId() && User.IsInRole("employee") && Model.ExecutorId == null  && Model.Comments.Where(c => c.UserId == User.Identity.GetUserId()).Count() < 1)
                {

                    <div class="sidebar-widget" id="add-offer-container">
                        <div class="bidding-widget">
                            <div class="bidding-headline"><h3>Добавить предложение</h3></div>
                            <div class="bidding-inner">
                                <!-- Headline -->
                                <span class="bidding-detail">Укажите <strong>стоимость работы</strong> </span>

                                <!-- Price Slider -->
                                <div class="bidding-value">
                                    <span id="add-offer-bidding-value"></span> руб. <button id="add-offer-show-price"><i title="Редактировать" data-tippy-placement="top" style="color:green" class="icon-line-awesome-pencil"></i></button>
                                </div>
                                <input id="add-offer-price-value" class="no-spinners" style="margin-bottom:5px; display:none"
                                       placeholder="Укажите стоимость" type="number" value="@Model.Price"
                                       oninput="validity.valid||(value='');" min="0" max="@maxCustomPrice"
                                       data-tippy-placement="top" />

                                <input id="add-offer-slider-price" class="bidding-slider" type="text" value="@Model.Price"
                                       data-slider-handle="custom" data-slider-currency="$" data-slider-min="0"
                                       data-slider-max="@maxCustomPrice" data-slider-value="@Model.Price" data-slider-step="50"
                                       data-slider-tooltip="hide" />

                                <!-- Headline -->
                                <span class="bidding-detail margin-top-30">Укажите <strong>срок выполнения</strong></span>

                                <!-- Fields -->
                                <div class="bidding-fields">
                                    <div class="bidding-field">
                                        <!-- Quantity Buttons -->
                                        <div class="qtyButtons">
                                            <div class="qtyDec"></div>
                                            <input id="add-offer-time" class="no-spinners" min="1" max="100" type="number" name="qtyInput"
                                                   step="1" value="1" oninput="validity.valid||(value='');">
                                            <div class="qtyInc"></div>
                                        </div>
                                    </div>
                                    <div class="bidding-field">
                                        <select class="selectpicker default" id="add-offer-time-units">
                                            <option value="1" selected>Дней</option>
                                            <option value="2">Часов</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- Headline -->
                                <span class="bidding-detail margin-top-30">Добавьте <strong>комментарий</strong></span>

                                <textarea id="add-offer-description" cols="30" rows="5" class="with-border" maxlength="200" placeholder="Оставьте своё предложение для заказчика..."></textarea>

                                <!-- Button -->
                                <button id="snackbar-place-bid" class="button ripple-effect move-on-hover full-width margin-top-30"><span>Разместить предложение</span></button>

                            </div>

                        </div>
                    </div>
                }


            </div>
        </div>

    </div>
</div>

<!-- Spacer -->
<div class="margin-top-15"></div>



@section Scripts {
    <script type="text/javascript">

        'use strict';

        $('#EndingDate').datepicker({
            startDate: new Date(),
            language: 'ru',
            autoclose: true,
            format: "dd M yyyy"
        }); //Initialise any date pickers

        (function (document, window, index) {
            // обнаруживаем другидруп
            var isAdvancedUpload = function () {
                var div = document.createElement('div');
                return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;
            }();


            // создаем эффекты для формы
            var forms = document.querySelectorAll('.box');
            Array.prototype.forEach.call(forms, function (form) {
                var input = form.querySelector('input[type="file"]'),
                    label = form.querySelector('label'),
                    errorMsg = form.querySelector('.box__error span'),
                    restart = form.querySelectorAll('.box__restart'),
                    droppedFiles = false,
                    showFiles = function (files) {
                       // надо подумать епта
                        label.textContent = /*files.length >= 1 ? (input.getAttribute('data-multiple-caption') || '').replace('{count}', files.length) */ files[0].name;
                    },
                    triggerFormSubmit = function () {
                        var event = document.createEvent('HTMLEvents');
                        event.initEvent('submit', true, false);
                        form.dispatchEvent(event);
                    };

                // добавлем флаги для серверного аякса
                var ajaxFlag = document.createElement('input');
                ajaxFlag.setAttribute('type', 'hidden');
                ajaxFlag.setAttribute('name', 'ajax');
                ajaxFlag.setAttribute('value', 1);
                form.appendChild(ajaxFlag);
                var globFiles = [];
                // автоматически отправялем форму
                input.addEventListener('change', function (e) {
                    showFiles(e.target.files);
                    globFiles = e.target.files;
                    triggerFormSubmit();
                });

                // чекаем другандрупные файлы
                if (isAdvancedUpload) {
                    form.classList.add('has-advanced-upload'); // если браузер не поддерживает файлы с помощью драгундруппо

                    ['drag', 'dragstart', 'dragend', 'dragover', 'dragenter', 'dragleave', 'drop'].forEach(function (event) {
                        form.addEventListener(event, function (e) {
                            // preventing the unwanted behaviours
                            e.preventDefault();
                            e.stopPropagation();
                        });
                    });
                    ['dragover', 'dragenter'].forEach(function (event) {
                        form.addEventListener(event, function () {
                            form.classList.add('is-dragover');
                        });
                    });
                    ['dragleave', 'dragend', 'drop'].forEach(function (event) {
                        form.addEventListener(event, function () {
                            form.classList.remove('is-dragover');

                        });
                    });
                    form.addEventListener('drop', function (e) {
                        droppedFiles = e.dataTransfer.files; // файлы для подгрузки в аяксе
                        globFiles = e.dataTransfer.files;
                        showFiles(droppedFiles);
                        triggerFormSubmit();
                    });
                }
                // если форма была отправлена
                form.addEventListener('submit', function (e) {
                    // убираем дубликаты
                    if (form.classList.contains('is-uploading')) return false;

                    form.classList.add('is-uploading');
                    form.classList.remove('is-error');

                    if (isAdvancedUpload) // чекаем проверку для поддержки бразуера
                    {
                        e.preventDefault();

                        var ajaxData = new FormData(form);
                        if (droppedFiles) {
                            for (var i = 0; i < droppedFiles.length; i++)
                                ajaxData.append("file"+i,droppedFiles[i]);
                               // ajaxData.append(input.getAttribute('name'), file);
                        }

                        // непосредственно запрос аякса Myattaches
                        var ajax = new XMLHttpRequest();
                        ajax.open(form.getAttribute('method'), form.getAttribute('action'), true);


                        if (form.getAttribute('action') == '/Custom/UploadTestMultiAttach/@Model.Id') {
                            ajax.onload = function () {
                                form.classList.remove('is-uploading');
                                if (ajax.status >= 200 && ajax.status < 400) {

                                   // alert("good")

                                    var votes = $("#MainAttaches");
                                    var num = $("#MainAttaches").text();
                                    // alert(num + (droppedFiles.length))
                                    if (parseInt(parseInt(parseInt(num) + parseInt(globFiles.length))) < 11) {
                                        votes.text(parseInt(parseInt(num) + parseInt(globFiles.length)));
                                    } else {
                                        Snackbar.show({
                                            text: 'Максимум 10 файлов решений!',
                                        });
                                        $("#textLab").text("Прикрепить решения");
                                        return false;
                                    }
                                    $('#Uploaded_Results_Main').load('@Url.Action("LoadMainAttaches", "Custom")?id=' +@Model.Id);

                                    var data = JSON.parse(ajax.responseText);
                                    $("#textLab").text("Прикрепить решения");
                                    form.classList.add(data.success != true ? 'is-success' : 'is-error');
                                    if (!data.success) errorMsg.textContent = data.error;
                                }
                                else { alert('Ошибка! Дайте пизды создателю'); $("#textLab").text("Прикрепить решения"); }
                            };
                        } else {
                             ajax.onload = function () {
                                form.classList.remove('is-uploading');
                                if (ajax.status >= 200 && ajax.status < 400) {
                                    var votes = $("#Myattaches");
                                    var num = $("#Myattaches").text();
                                    // alert(num + (droppedFiles.length))
                                    if (parseInt(parseInt(parseInt(num) + parseInt(globFiles.length))) < 11) {
                                        votes.text(parseInt(parseInt(num) + parseInt(globFiles.length)));
                                    } else {
                                        Snackbar.show({
                                            text: 'Максимум 10 файлов вложений!',
                                        });
                                        $("#textLab").text("Прикрепить вложение");
                                        return false;
                                    }
                                    $('#Uploaded_Results_My').load('@Url.Action("LoadMyAttaches", "Custom")?id=' +@Model.Id);

                                    var data = JSON.parse(ajax.responseText);
                                    $("#textLab").text("Прикрепить вложения");
                                    form.classList.add(data.success != true ? 'is-success' : 'is-error');
                                    if (!data.success) errorMsg.textContent = data.error;
                                }
                                else { alert('Ошибка! Дайте пизды создателю'); $("#textLab").text("Прикрепить вложения"); }
                            };
                        }

                        ajax.onerror = function () {
                            form.classList.remove('is-uploading');
                            $("#textLab").text("Прикрепить решения");
                            alert('Ошибка блять ты мудак!');
                        };

                        ajax.send(ajaxData);
                    }
                    else
                    { // создаем окно для дальнейших действий
                        var iframeName = 'uploadiframe' + new Date().getTime(),
                            iframe = document.createElement('iframe');

                        $iframe = $('<iframe name="' + iframeName + '" style="display: none;"></iframe>');

                        iframe.setAttribute('name', iframeName);
                        iframe.style.display = 'none';

                        document.body.appendChild(iframe);
                        form.setAttribute('target', iframeName);

                        iframe.addEventListener('load', function () {

                            if (parseInt(num + droppedFiles.length) < 10) {
                                votes.text(parseInt(parseInt(num) + parseInt(globFiles.length)));
                            } else {
                                Snackbar.show({
                                    text: 'Максимум 10 файлов решений!',
                                });
                                $("#textLab").text("Прикрепить решения");
                                return false;
                            }
                            var data = JSON.parse(iframe.contentDocument.body.innerHTML);
                            form.classList.remove('is-uploading')
                            form.classList.add(data.success == true ? 'is-success' : 'is-error')
                            form.removeAttribute('target');

                            if (!data.success) errorMsg.textContent = data.error;
                            iframe.parentNode.removeChild(iframe);
                        });
                    }
                });

                // рестарт формы если была ошибка
                Array.prototype.forEach.call(restart, function (entry) {
                    entry.addEventListener('click', function (e) {
                        e.preventDefault();
                        form.classList.remove('is-error', 'is-success');
                        input.click();
                    });
                });

                // глянул баг для фаерфокса
                input.addEventListener('focus', function () { input.classList.add('has-focus'); });
                input.addEventListener('blur', function () { input.classList.remove('has-focus'); });

            });
        }(document, window, 0));

    </script>

    <script>

        var minValue = 1;   //min days
        var maxValue = 100; //max days

        $("#checkbox1").click(function () {
            if ($(this).is(':checked')) {
                $("#ExecutorPrice").prop("disabled", true);
                $("#ExecutorPrice").css("background-color", "#f2f2f2");
                $("#ExecutorPrice").attr("placeholder", "Бесплатно");
                $("#ExecutorPrice").val('0');
            } else {
                $("#ExecutorPrice").prop("disabled", false);
                $("#ExecutorPrice").css("background-color", "#ffffff");
                $("#ExecutorPrice").attr("placeholder", "Цена");
            }
        });



        $(document).ready(function () {
            RangeSlider();

            $(document).on('click', '#add-offer-show-price', function (event) {
                $('#add-offer-price-value').toggle('show');
            });

            $(document).on('click', '#edit-comment-show-price', function (event) {
                $('#edit-comment-price-value').toggle('show');
            });

            $(document).on('keyup', '#add-offer-price-value', function (event) { // задаем функцию при отпускании после нажатия любой клавиши клавиатуры на элементе
                var addOfferBox = document.getElementById('add-offer-price-value');
                var addOfferSliderValue = document.getElementById('add-offer-slider-price');
                addOfferSliderValue.value = addOfferBox.value;
                $("#add-offer-bidding-value").text(addOfferBox.value);
                $("#add-offer-slider-price").slider('setValue', addOfferBox.value);
            });

            $(document).on('keyup', '#edit-comment-price-value',function (event) {
                var editCommentBox = document.getElementById('edit-comment-price-value');
                var editCommentSliderValue = document.getElementById('edit-comment-slider-price');
                editCommentSliderValue.value = editCommentBox.value;
                $("#edit-comment-bidding-value").text(editCommentBox.value);
                $("#edit-comment-slider-price").slider('setValue', editCommentBox.value);
            });

            $("#executors-offers .lds-ring").hide();
            $("#boxed-list-ul > li:odd").css("background-color", "#fafafa");
        });

        $('#reject-executor').on('click', function () {
            $(".mfp-close").trigger('click');
            Snackbar.show({
                text: 'Ваша заявка на отклонение исполнителя передана на рассмотрение!',
            });
        });

       // $(".lds-ring").hide();

        function ChangeStatusSpan() {
            $.ajax({
                url: '@Url.Action("GetCustomStatus", "Custom")?id=' + @Model.Id,
                success: function (data) {
                    $('#custom-status > span').text(data);
                    if (data == 'Проверяется заказчиком' && '@(Model.UserId==User.Identity.GetUserId())'=='True') {
                        Snackbar.show({
                            text: 'Теперь Вам доступно закрытие заказа или отправление на доработку.',
                        });
                    }
                    //console.log('status: '+ data);
                    return data;
                },
                error: function (data) {
                    console.log('Custom/GetCustomStatus is gone bad!');
                }
            });
        }

        function ConfirmDone() {
            return confirm("Вы уверены, что хотите удалить вложение?");
        }


        $('input[id^="choose-executor"], #send-for-revision, #accept-custom, #close-custom'/*, '#download-main-by-customer'*/).on('click', function (e) {
            ChangeStatusSpan();
        });

        function DownloadMainAttachmentByCustomer(fileId, customId, path) {
            //alert('path = ' + path);
            $.ajax({
                url: '@Url.Action("DownloadMainAttachment", "Custom")',
                data: {
                    'fileId': fileId,
                    'customId': customId
                },
                //type : "POST",
                //contentType: 'application/json; charset=utf-8',
                //datatype: 'json',
                 type: "GET",
                 success: function () {
                     window.location = '@Url.Action("GetFile", "Custom")?path=' + path;
                     /////////////
                     $.ajax({
                        type: "GET",
                        url: '@Url.Action("NotDownloadedMainAttaches", "Custom")?id=' +@Model.Id,
                        success: function (data) {
                            //alert(data);
                            if (data == 0) {
                                $('.buttons-container').load('@Url.Action("LoadButtons", "Custom")?id=' +@Model.Id);
                                ChangeStatusSpan();
                            }
                        },
                        error: function (data) {
                            alert('Custom/NotDownloadedMainAttaches is gone bad!');
                        }
                     });
                     ////////////
                     return true;
                },
                error: function () {
                    alert('Custom/DownloadMainAttachment is gone bad!');
                    return false;
                }
            });
        }

        @*$('#getArch').on('click', function () {
            $.ajax({
                url: '@Url.Action("GetMyAttachments", "Custom")?id=' + '@Model.Id',
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (result) {
                    $.ajax({
                        url: '@Url.Action("GetArchive", "Custom")',
                        type: 'POST',
                        data: { 'files': result },
                        success: function (result) {
                           // window.location =;
                        },
                        error: function (result) {
                            alert('Вложение удалено');
                        }
                    });
                },
                error: function (result) {
                    alert('Вложение удалено');
                }
            });

        });*@

        $('a[name=deleteAt]').on('click', function (e) {
            var ItemId = $('a[name=deleteAt]').prop('id').replace('buyElement1-', '');

            $.ajax({
                cache: false,
                url: '@Url.Action("DeleteAttach", "Custom")',
                type: 'POST',
                data: { id: ItemId },
                success: function (result) {
                    $('#Uploaded_Revisions').load('@Url.Action("LoadAttaches", "Custom")?id=' +@Model.Id);
                },
                error: function (result) {
                    alert('Вложение удалено');
                }
            });
        });

        function OnSuccessDeleteMainAttach(attachId) {
            $("#ldsDelMainAttach" + attachId).show()
            $("#ldsDelMainAttach" + attachId).children().show()
            $("#fDelMain" + attachId).hide();
            $("#ldsDelMainAttach" + attachId).children().css('border-color', '#ffffff transparent transparent transparent');
            $('#Uploaded_Results_Main').load('@Url.Action("LoadMainAttaches", "Custom")?id=' +@Model.Id);
            $('#MainAttaches').text(function (i, txt) {
                return (parseInt(txt, 10) - 1);
            });

            ChangeStatusSpan();
        }


        function OnSuccessDeleteAttach(attachId) {
            $("#ldsDelAttach" + attachId).show()
            $("#ldsDelAttach" + attachId).children().show()
            $("#fDelbuy" + attachId).hide();
            $("#ldsDelAttach" + attachId).children().css('border-color', '#ffffff transparent transparent transparent');
            $('#Uploaded_Revisions').load('@Url.Action("LoadAttaches", "Custom")?id=' +@Model.Id);
            $('#revisions').text(function (i, txt) {
                return (parseInt(txt, 10) - 1);
            });

            ChangeStatusSpan();
        }

        function OnBeginBuyAttach(attachId) {
            //alert('attachId = ' + attachId);
            $("#ldsAttach" + attachId).show()
            $("#ldsAttach" + attachId).children().show()
            $("#fbuy" + attachId).hide();
            $("#textAttachBuy" + attachId).hide();
            $("#ldsAttach" + attachId).children().css('border-color', '#ffffff transparent transparent transparent');
            $.ajax({
                type: "GET",
                url: '@Url.Action("EnoughMoneyForBuying", "Custom")',
                data: {
                    'id': attachId
                },
                success: function (data) {
                    //console.log('success EnoughMoneyForBuying | data = '+data);
                    if (data == 'True') {
                        //console.log('True');
                        return true;
                    }
                    else {
                        Snackbar.show({
                            text: 'Недостаточно средств на счету!',
                        });
                        $("#fbuy" + attachId).show();
                        $("#textAttachBuy" + attachId).show();
                        $("#ldsAttach" + attachId).children().hide();
                        return false;
                    }
                },
                error: function (data) {
                    Snackbar.show({
                        text: 'Исполнитель уже удалил этот файл! Перезагрузите страницу.',
                    });
                    $("#fbuy" + attachId).show();
                    $("#textAttachBuy" + attachId).show();
                    $("#ldsAttach" + attachId).children().hide();
                    console.log('Custom/EnoughMoneyForBuying is gone bad!');
                    return false;
                }
            });
        }

        function IsGone() {
            console.log("Недостаточно средств");
        }

        function OnSuccessBuyAttach(attachId) {
            //console.log('In OnSuccessBuyAttach');
            $('#Uploaded_Revisions').load('@Url.Action("LoadAttaches", "Custom")?id=' +@Model.Id);
            $.ajax({
                type: "GET",
                url: '@Url.Action("NotPurchasedAttaches", "Custom")?id=' +@Model.Id,
                success: function (data) {
                    //alert(data);
                    if (data == 0) {
                        $("#fbuy" + attachId).show();
                        $("#textAttachBuy" + attachId).show();
                        $("#ldsAttach" + attachId).children().hide();
                        $('.buttons-container').load('@Url.Action("LoadButtons", "Custom")?id=' +@Model.Id);
                        ChangeStatusSpan();
                    }
                    $('#revisions').text(function (i, txt) {
                        return (parseInt(txt, 10) + 1);
                    });
                },
                error: function (data) {
                    alert('Custom/NotPurchasedAttaches is gone bad!');
                }
            });
        }

        var progressBar = $('#progressbar');

        $('#add-revision').on('click', function (e) {
            $("#textAttach").hide();
            $(".lds-ring").children().show();
            $(".lds-ring").children().css('border-color', '#ffffff transparent transparent transparent');
            e.preventDefault();
            var c = document.getElementById('CustomViewModelId').value;
            var d = document.getElementById('ExecutorPrice').value;
            if (document.getElementById('ExecutorPrice').value == '') {
                d = 0;
            }
            var files = document.getElementById('uploadFile').files;
            if (files.length > 0) {
                if (window.FormData !== undefined) {
                    var data = new FormData();
                    for (var x = 0; x < files.length; x++) {
                        data.append("file" + x, files[x]);
                        data.append('CustomViewModelId', c);
                        data.append('ExecutorPrice', d)
                    }

                    $.ajax({
                        xhr: function () {
                            var xhr = new window.XMLHttpRequest();
                            xhr.upload.addEventListener("progress", function (evt) {
                                if (evt.lengthComputable) {
                                    var percentComplete = evt.loaded / evt.total;
                                    console.log(percentComplete);
                                    $('.progress').css({
                                        width: percentComplete * 100 + '%'
                                    });
                                    if (percentComplete === 1) {
                                        $('.progress').addClass('hide');
                                    }
                                }
                            }, false);
                            xhr.addEventListener("progress", function (evt) {
                                if (evt.lengthComputable) {
                                    var percentComplete = evt.loaded / evt.total;
                                    $('.progress').css({
                                        width: percentComplete * 100 + '%'
                                    });
                                }
                            }, false);
                            return xhr;
                        },
                        type: "POST",
                        url: '@Url.Action("UploadRevision", "Custom")',
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (result) {
                            ChangeStatusSpan();
                            $('#Uploaded_Revisions').load('@Url.Action("LoadAttaches", "Custom")?id=' +@Model.Id);
                            var votes = $("#revisions");
                            var num = $("#revisions").text();
                            if (parseInt(num) < 10) {
                                votes.text(parseInt(num) + 1);
                                $('.accordion-body').hide();
                                $("#textAttach").show();
                                $(".lds-ring").children().hide();
                                document.getElementById("uploadFile").value = "";
                                $('.uploadButton-file-name').text("Загрузите файл решения для исполнителя любого формата")
                                location.hash = "#" + 'Uploaded_Revisions';

                            } else {
                                Snackbar.show({
                                    text: 'Максимум 10 файлов решений!',
                                });
                                $('.accordion-body').hide();
                                $("#textAttach").show();
                                $(".lds-ring").children().hide();
                                document.getElementById("uploadFile").value = "";
                                $('.uploadButton-file-name').text("Загрузите файл решения для исполнителя любого формата")
                                location.hash = "#" + 'Uploaded_Revisions';
                                //return;
                            }
                            $('#checkbox1').prop('checked', false);
                            $('#ExecutorPrice').val('');
                            $("#ExecutorPrice").prop("disabled", false);
                            $("#ExecutorPrice").css("background-color", "#ffffff");
                            $("#ExecutorPrice").attr("placeholder", "Цена");
                        },
                        error: function (xhr, status, p3) {
                            alert(xhr.responseText);
                        }
                    });
                } else {
                    alert("Браузер не поддерживает загрузку файлов HTML5!");
                }
            }
            else {
                $("#textAttach").show();
                $(".lds-ring").children().hide();
                Snackbar.show({
                    text: 'Прикрепите хотя бы одно решение!',
                });
            }
        });

        $('#submitAttach').on('click', function (e) {
            $("#attbank .lds-ring").children().show();
            $("#textAttach").hide();
           // $(".lds-ring").children().css('display', '');
            $(".lds-ring").children().css('border-color', '#ffffff transparent transparent transparent');
            e.preventDefault();
            var c = document.getElementById('CustomViewModelId').value;
            var files = document.getElementById('uploadFile').files;
            if (files.length > 0) {
                if (window.FormData !== undefined) {
                    var data = new FormData();
                    for (var x = 0; x < files.length; x++) {
                        data.append("file" + x, files[x]);
                        data.append('CustomViewModelId', c);
                    }

                    $.ajax({
                        xhr: function () {
                            var xhr = new window.XMLHttpRequest();
                            xhr.upload.addEventListener("progress", function (evt) {
                                if (evt.lengthComputable) {
                                    var percentComplete = evt.loaded / evt.total;
                                    console.log(percentComplete);
                                    $('.progress').css({
                                        width: percentComplete * 100 + '%'
                                    });
                                    if (percentComplete === 1) {
                                        $('.progress').addClass('hide');
                                    }
                                }
                            }, false);
                            xhr.addEventListener("progress", function (evt) {
                                if (evt.lengthComputable) {
                                    var percentComplete = evt.loaded / evt.total;
                                    $('.progress').css({
                                        width: percentComplete * 100 + '%'
                                    });
                                }
                            }, false);
                            return xhr;
                        },
                        type: "POST",
                        url: '@Url.Action("UploadAttach", "Custom")',
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (result) {
                            $('#Uploaded_Results_My').load('@Url.Action("LoadMyAttaches", "Custom")?id=' +@Model.Id);
                            var votes = $("#Myattaches");
                            var num = $("#Myattaches").text();
                            if (votes.text() == 0) {
                                 $('#getAr').load('@Url.Action("LoadButtonArch", "Custom")?id=' +@Model.Id);
                            }
                            if (num < 10) {
                                votes.text(parseInt(num) + 1);
                                document.getElementById("uploadFile").value = "";
                                $('.uploadButton-file-name').text("Загрузите файл вложения любого формата")
                                $('.accordion-body').hide();
                                $("#textAttach").show();
                                $(".lds-ring").children().hide();
                            } else {
                                Snackbar.show({
                                    text: 'Максимум 10 файлов решений!',
                                });
                                document.getElementById("uploadFile").value = "";
                                $('.uploadButton-file-name').text("Загрузите файл вложения любого формата")
                                $('.accordion-body').hide();
                                $("#textAttach").show();
                                $(".lds-ring").children().hide();
                            }
                        },
                        error: function (xhr, status, p3) {
                            alert(xhr.responseText);
                        }
                    });
                } else {
                    alert("Браузер не поддерживает загрузку файлов HTML5!");
                }
            }
        });



        var countUserComment = 0;
        $(document).on('click', '#snackbar-place-bid', function () {
            var description = $("#add-offer-description").val();
            var slider = $("#add-offer-slider-price").val();
            var time = $("#add-offer-time").val();
            var timeUnit = $("#add-offer-time-units").val();

            if (description == "") {
                Snackbar.show({
                    text: 'Добавьте комментарий!',
                });
                return;
            }
            if (slider == "") {
                Snackbar.show({
                    text: 'Добавьте стоимость выполнения!',
                });
                return;
            }
            if (time == "") {
                Snackbar.show({
                    text: 'Добавьте срок выполнения!',
                });
                return;
            }
            if (time < minValue || time > maxValue) {
                Snackbar.show({
                    text: 'Введите число в диапазоне от ' + minValue + ' до ' + maxValue + '!',
                });
                return;
            }
            $('#votes').hide();
           // $("#executors-offers .lds-ring").show();

            var hours = 0;
            var days = time;    //default
            //if hours were selected
            if (timeUnit == 2) {
                hours = time;
                days = 0;
            }
            var person = { Description: description, OfferPrice: slider, Days: days, Hours: hours, CustomViewModelId: @Model.Id };

            var executorsRating;
            var executorImagePath;
           // $.post("/Custom/People", person, null, "json");
            $.ajax({
                type: "POST",
                url: "/Custom/ShowExecutors",
                data: person,
                dataType: "json",
                success: function (data) {
                    var commentId = data.Id;
                    executorsRating = data.ExecutorRating;
                    executorImagePath = data.ExecutorImagePath;

                    var modalEdit = '<div id="small-dialog" class="zoom-anim-dialog mfp-hide dialog-with-tabs"><div class="sign-in-form"><ul class="popup-tabs-nav"><li class="active"><a href="#tab">Редактировать предложение </a></li></ul><div class="popup-tabs-container"><div class="popup-tab-content" id="tab">'
                        + '<form method="post" action="/Custom/EditComment/'
                        + data.Id + '" data-ajax="true" data-ajax-mode="replace" data-ajax-success="return OnSuccessEditComment('+data.Id+')" data-ajax-begin="return OnBeginEditComment()" data-ajax-update="#user-comment-bid-rate-' + data.Id + '">'
                        + '@Html.AntiForgeryToken() '
                        + '<input type="hidden" value="' + data.UserId + '" name="UserId" />'
                        + '<input type="hidden" value="' + data.CustomViewModelId + '" name="CustomViewModelId" />'
                        + '<input type="hidden" value="' + data.Description + '" name="Description" />'
                        + '<input type="hidden" id="edit-comment-description" value = "' + data.CreationDate + '" name="CreationDate" />'

                        + '<span class="bidding-detail">Укажите <strong>стоимость работы</strong></span>'
                        + '<div class="bidding-value"><span id="edit-comment-bidding-value"></span> руб. <button type="button" id="edit-comment-show-price"><i title="Редактировать" data-tippy-placement="top" style="color:green" class="icon-line-awesome-pencil"></i></button>'

                        +'<input id="edit-comment-price-value" name="OfferPrice" class="no-spinners" style="margin-bottom:5px; display:none"'
                        +'placeholder="Укажите стоимость" type="number" value="0"'
                        +'oninput="validity.valid||(value=\'\');" min="0" max="@maxCustomPrice"'
                        +'data-tippy-placement="top"/></div>'

                        + '<input id="edit-comment-slider-price" name="OfferPrice" class="bidding-slider" type="text" value="'
                        + '" data-slider-handle="custom" data-slider-currency="$" data-slider-min="0" data-slider-max="@maxCustomPrice" data-slider-value="'
                        + data.OfferPrice + '" data-slider-step="50" data-slider-tooltip="hide"/>'

                        + '<div class="bidding-widget"><span class="bidding-detail margin-top-30">Укажите время выполнения</span>'
                        + '<div class="bidding-fields"><div class="bidding-field"><div class="qtyButtons with-border"><div class="qtyDec"></div>';

                    if (days > 0) {
                        modalEdit += '<input id="edit-comment-time" type="number" class="no-spinners" min="' + minValue + '" max="' + maxValue
                            + '" name="Days" value="' + days+ '" step="1" oninput="validity.valid||(value=\'\');">'
                            + '<div class="qtyInc"></div></div></div>'
                            + '<div class="bidding-field"><select class="selectpicker default with-border" id="edit-time-units">'
                            + '<option selected value="1">дней</option><option value="2">часов</option>';
                    }
                    else {
                        modalEdit += '<input id="edit-comment-time" type="number" class="no-spinners" min="' + minValue + '" max="' + maxValue
                            + '" name="Hours" value="' + hours + '" step="1" oninput="validity.valid||(value=\'\');">'
                            + '<div class="qtyInc"></div></div></div>'
                            + '<div class="bidding-field"><select class="selectpicker default with-border" id="edit-time-units">'
                            + '<option value="1">дней</option><option selected value="2">часов</option>';
                    }
                    modalEdit += '</select></div></div><br/>'

                        + '</div><span class="bidding-detail margin-top-10">Добавьте <strong>комментарий:</strong></span>'
                        + '<textarea id="edit-comment-desсription" name="Description" cols="30" rows="5" '
                        + 'class="with-border" maxlength="200" placeholder="Оставьте своё предложение для заказчика..." >'
                        + data.Description+'</textarea> <button class="button full-width button-sliding-icon ripple-effect" type="submit">Сохранить <i class="icon-material-outline-arrow-right-alt"></i></button></form></div></div></div></div> ';


                    var modalRemove = '<div id="small-dialog-3" class="zoom-anim-dialog mfp-hide dialog-with-tabs">'
                        + '<div class="sign-in-form"><ul class="popup-tabs-nav">'
                        + '<li class="active"><a href="#tab">Удалить предложение</a></li>'
                        + '</ul><div class="popup-tabs-container">'
                        + '<div class="popup-tab-content" id="tab">'
                        + '<div class="bidding-widget">'
                        + '<div class="form-actions no-color"><span class="bidding-detail margin-top-30">Действительно хотите удалить предложение?</span>'
                        + '</div></div>'
                        + '<button class="button full-width button-sliding-icon ripple-effect" onclick="return OnClickDeleteComment(' + data.Id + ')" type="submit">Подтвердить <i class="icon-material-outline-arrow-right-alt"></i></button>'
                        + '</div></div></div></div>';

                    var votes = $("#votes");
                    var num = $("#votes").text();
                    votes.text(parseInt(num) + 1);

                    /****/
                    var htmlEditAndRemoveBind = '<div style="margin-left: 23px;" class="buttons-to - right always - visible">'
                        + '<a href="#small-dialog" class="popup-with-zoom-anim button dark ripple-effect ico" title = "Редактировать" data-tippy-placement="top"> <i class="icon-feather-edit"></i></a > '
                        + ' <a href="#small-dialog-3" class="popup-with-zoom-anim button red ripple-effect ico" title="Удалить" data-tippy-placement="top"><i class="icon-feather-trash-2"></i></a>'
                        + '</div > ';
                    var htmlStar = '<div id="starId" class="star-rating" data-rating="' + executorsRating+'"></div>';

                    var htmlComment = '<li id="user-comment-' + data.Id + '">' + "<div class='bid'><div class='bids-avatar'><div class='freelancer-avatar'><a href='@Url.Action("Details", "User", new { userName = User.Identity.Name})'><img src='" + executorImagePath + "' alt='аватар' id='_executorImage'></a></div></div><div class='bids-content'><div class='freelancer-name'><h4><a href='@Url.Action("Details", "User", new { userName = User.Identity.Name })'>@User.Identity.Name  <h6 class='custom-comments'>" + data.CreationDate +"</h6></a></h4>"
                        + htmlStar + "</div></div><div class='bids-bid'><div class='bid-rate' id='user-comment-bid-rate-"+data.Id+"'><div class='rate'>"
                        + person.OfferPrice + " рублей</div><span>за ";

                    if (person.Days > 0) {
                        htmlComment += person.Days + ' дней</span>';
                    }
                    else {
                        htmlComment += person.Hours + ' часов</span>';
                    }

                    htmlComment += '</div>'
                        + htmlEditAndRemoveBind + "</div></div><div class='item-description margin-top-30'><p>"
                        + person.Description + "</p></div></li>";

                    if (HasComments(@Model.Id) || countUserComment >= 1) {
                        //$(".lds-ring").children().hide();
                        $('#votes').show();
                        Snackbar.show({
                            text: 'Вы не можете добавлять более 1 предложения!',
                        });
                        return null;
                    }
                    else {
                        // не было отступа из-за <li></li>
                        //при добавлении нового комента(сразу же после удаления)
                        if ($('#boxed-list-ul>li[id*="user-comment"]').is(':empty')) {
                            $('#boxed-list-ul>li[id*="user-comment"]').remove();
                        }
                        if($('#small-dialog').length) {
                            $('#small-dialog').remove();
                        }
                        if($('#small-dialog-3').length) {
                            $('div#small-dialog-3').remove();
                        }

                        $("#boxed-list-ul").prepend(htmlComment);
                        $("#boxed-list-ul").prepend(modalEdit);
                        $("#boxed-list-ul").prepend(modalRemove);

                        function qtySum() {
                            var arr = document.getElementsByName('qtyInput');
                            var tot = 0;
                            for (var i = 0; i < arr.length; i++) {
                                if (parseInt(arr[i].value)) {
                                    tot += parseInt(arr[i].value);
                                }
                            }
                        }
                        qtySum();

                        $('#starId')[0].click();
                        countUserComment++;

                    }
                   /***************************************************************/
                    $('.selectpicker').selectpicker();
                    $("#starId").attr("data-rating", executorsRating);
                    $("#starId li").attr("id", "user-comment-" + commentId);
                    $("#_executorImage").attr('src', executorImagePath);
                    starRating('#starId');
                    $("#add-offer-container").hide(500);
                    $("#add-offer-container").empty();
                    RangeSlider();
                    $(".lds-ring").children().hide();
                    $('#votes').show();
                    Snackbar.show({
                        text: 'Предложение успешно добавлено!',
                    });
                },
                error: function (data) {
                    alert('Bratan, it is very ploho s "Custom/ShowExecutors: "' + data.statusText);
                }
            });
        });

        $('#checkEx').click(function () {
            $.ajax({
                type: 'GET',
                url: "/Custom/IsExecutor/" + @Model.Id,
                success: function (data) {
                    if (data) {
                        Snackbar.show({
                            text: 'Вы не можете редактировать предложение, вас выбрали исполнителем!',
                        });
                        return false;
                    } else {
                        return true;
                    }
                }
            });
        });

        //!!check this for incrementing bug
        $(document).on("click", ".qtyDec, .qtyInc", function () {

            var events = $._data(this, "events");
            if (events == null) {
                //var minValue = 1;
                //var maxValue = 100;
                var $button = $(this);
                var buttonHasClassInc = $button.hasClass('qtyInc');
                var oldValue = $button.parent().find("input").val();

                if (oldValue < minValue || (oldValue == minValue && !buttonHasClassInc)) {
                    $button.parent().find("input").val(minValue);
                }
                else {
                    if (oldValue > maxValue || (oldValue == maxValue && buttonHasClassInc)) {
                        $button.parent().find("input").val(maxValue);
                    }
                    else {
                        if (buttonHasClassInc) {
                            $button.parent().find("input").val(parseFloat(oldValue) + 1);
                        }
                        else {
                            $button.parent().find("input").val(parseFloat(oldValue) - 1);
                        }
                    }
                }

                function qtySum() {
                    var arr = document.getElementsByName('qtyInput');
                    var tot = 0;
                    for (var i = 0; i < arr.length; i++) {
                        if (parseInt(arr[i].value)) {
                            tot += parseInt(arr[i].value);
                        }
                    }
                }
                qtySum();
                $(".qtyTotal").addClass("rotate-x");}
        });


        $('#boxed-list-ul').on('click', 'a[href="#small-dialog"]', function () {
            //alert('edit');
            var el = $('#small-dialog');
            $.magnificPopup.open({
                items: {
                    src: el,
                },
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,

                overflowY: 'auto',

                closeBtnInside: true,
                preloader: false,

                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in'
            });
        });

        $('#boxed-list-ul').on('click', 'a[href="#small-dialog-3"]', function () {
            //alert('delete');
            var el = $('#small-dialog-3');
            $.magnificPopup.open({
                items: {
                    src: el,
                },
                type: 'inline',
                fixedContentPos: false,
                fixedBgPos: true,

                overflowY: 'auto',

                closeBtnInside: true,
                preloader: false,

                midClick: true,
                removalDelay: 300,
                mainClass: 'my-mfp-zoom-in'
            });
        });

        $('#buttonsCont').on('click', 'a[href="#small-dialog-4"]', function () {
        //alert('delete');
        var el = $('#small-dialog-4');
        $.magnificPopup.open({
            items: {
                src: el,
            },
            type: 'inline',
            fixedContentPos: false,
            fixedBgPos: true,

            overflowY: 'auto',

            closeBtnInside: true,
            preloader: false,

            midClick: true,
            removalDelay: 300,
            mainClass: 'my-mfp-zoom-in'
        });
    });

        $("#edit-time-units").on('change', function () {
            if ($(this).val() == 1) {
                $('#edit-comment-time').attr('name', 'Days');
            }
            else {
                $('#edit-comment-time').attr('name', 'Hours');
            }
        });


        function HasComments(customId) {
            $.ajax({
                type: 'GET',
                contentType: "application/json",
                url: "/Custom/HasComments/"+customId,
                success: function (data) {
                    return data;
                }
            });
        }


        function OnBeginEditComment() {
            var description = $("#edit-comment-desсription").val();
            var slider = $("#edit-comment-slider-price").val();
            var time = $("#edit-comment-time").val();
            var timeUnit = $("#edit-time-units").val();
            if (description == "") {
                Snackbar.show({
                    text: 'Добавьте комментарий!',
                });
                return false;
            }
            if (slider == "") {
                Snackbar.show({
                    text: 'Добавьте стоимость выполнения!',
                });
                return false;
            }
            if (time == "") {
                Snackbar.show({
                    text: 'Добавьте срок выполнения!',
                });
                return false;
            }
            if (time < minValue || time > maxValue) {
                Snackbar.show({
                    text: 'Введите число в диапазоне от ' + minValue + ' до ' + maxValue + '!',
                });
                return false;
            }
            return true;

        }

        function OnSuccessEditComment(commentId) {
            var userDescriptionId = '#user-comment-' + commentId + " .item-description";
            var newDescription = $('#edit-comment-desсription').val();
            //console.log('userDescriptionId = ' + userDescriptionId);
            //console.log('newDescription = ' + newDescription);
            $(userDescriptionId).text(newDescription);
            $(".mfp-close").trigger('click');
            Snackbar.show({
                text: 'Предложение успешно изменено!',
            });
        }

        function OnClickDeleteComment(commentId) {
            //alert('aaaa');
            $.ajax({
                type: 'GET',
                url: '@Url.Action("IsExecutor", "Custom")',
                data: { 'id': commentId },
                success: function (isExec) {
                    //console.log('isExec = ' + isExec);
                    if (isExec=="True") {
                        Snackbar.show({
                            text: 'Вы не можете удалять предложение, вас уже выбрали исполнителем!',
                        });
                        return;
                    }
                    else {
                        //console.log('commentId =' + commentId);
                        $.ajax({
                            type: "GET",
                            url: '@Url.Action("DeleteComment", "Custom")',
                            data: { 'id': commentId },
                            success: function (data) {
                                if (countUserComment > 0) countUserComment--;
                                $("#user-comment-" + commentId).remove();
                                $(".mfp-close").trigger('click');
                                var votes = $("#votes");
                                var num = $("#votes").text();
                                votes.text(parseInt(num) - 1);
                                //удаляем модальные окна,
                                //а то косяк с редактированием после удаления
                                if ($('#small-dialog').length) {
                                    //alert('remove EDIT');
                                    $('#small-dialog').remove();
                                }
                                if ($('#small-dialog-3').length) {
                                    //alert('remove DELETE');
                                    $('#small-dialog-3').remove();
                                }

                                var addOfferContainer = '<div class="bidding-widget">'
                                    + '<div class="bidding-headline"><h3>Добавить предложение</h3></div>'
                                    + '<div class="bidding-inner"><span class="bidding-detail">Укажите <strong>стоимость работы</strong></span>'
                                    + '<div class="bidding-value"><span id="add-offer-bidding-value"></span> руб. <button id="add-offer-show-price"><i title="Редактировать" data-tippy-placement="top" style="color:green" class="icon-line-awesome-pencil"></i></button></div>'

                                    +'<input id="add-offer-price-value" class="no-spinners" style="margin-bottom:5px; display:none" '
                                    +'placeholder="Укажите стоимость" type="number" value="@Model.Price" '
                                    + ' min="0" max="@maxCustomPrice" data-tippy-placement="top" '
                                    + 'oninput="validity.valid||(value=\'\');"/>'

                                    + '<input id="add-offer-slider-price" class="bidding-slider" type="text" value="@Model.Price" '
                                    + 'data-slider-handle="custom" data-slider-currency="$" data-slider-min="0" '
                                    + 'data-slider-max="@maxCustomPrice" data-slider-value="@Model.Price" data-slider-step="50" data-slider-tooltip="hide"/>'

                                    + '<span class="bidding-detail margin-top-30">Укажите <strong>срок выполнения</strong></span>'
                                    + '<div class="bidding-fields"><div class="bidding-field">'
                                    + '<div class="qtyButtons"><div class="qtyDec"></div>'

                                    + '<input id="add-offer-time" type="number" class="no-spinners" min="' + minValue + '" max="' + maxValue + '" '
                                    + 'name="qtyInput" step="1" value="1" oninput="validity.valid||(value=\'\');"/>'

                                    + '<div class="qtyInc"></div></div></div><div class="bidding-field">'
                                    + '<select class="selectpicker default" id="add-offer-time-units">'
                                    + '<option value="1" selected>Дней</option><option value="2">Часов</option></select></div>'
                                    + '</div><span class="bidding-detail margin-top-30">Добавьте <strong>комментарий</strong></span>'
                                    + '<textarea id="add-offer-description" cols="30" rows="5" class="with-border" maxlength="200" placeholder="Оставьте своё предложение для заказчика..."></textarea>'
                                    + '<button id="snackbar-place-bid" class="button ripple-effect move-on-hover full-width margin-top-30"><span>Разместить предложение</span></button>'
                                    + '</div></div>';

                                if ($('#add-offer-container').length) {
                                    $("#add-offer-container").append(addOfferContainer);
                                }
                                else {
                                    addOfferContainer = '<div class="sidebar-widget" id="add-offer-container">'
                                        + addOfferContainer
                                        + '</div>';
                                    $('.sidebar-container').append(addOfferContainer);
                                }

                                $('.selectpicker').selectpicker();
                                RangeSlider();

                                $("#add-offer-container").show(500);
                                $._data($('#snackbar-place-bid'), "events");
                                Snackbar.show({
                                    text: 'Предложение успешно удалено!',
                                });
                            },
                            error: function (data) {
                                //console.log('data = ' + data);
                                //console.log('Custom/DeleteComment is gone bad!');
                            }
                        });
                    }
                },
                error: function () {
                    alert("Custom/IsExecutor is gone bad!");
                }
            });
        }


        $('#sortComments').on('change', function () {
            var sortingType = $(this).val();
            //console.log('sortingType = '+sortingType);
            var initialComments = $('.comments');
            var sortedComments;

            switch (sortingType) {
                case '2'://по давним
                    //console.log('sortComments = по давним');
                    sortedComments = initialComments.sort(function (a, b) {
                        var firstDiv = $(a).find('h6').text();
                        var secondDiv = $(b).find('h6').text();
                        return (firstDiv > secondDiv) ? 1 : (firstDiv < secondDiv) ? -1: 0;
                    });
                    break;

                case '3'://по рейтингу
                    //console.log('sortComments = по рейтингу');
                    sortedComments = initialComments.sort(function (a, b) {
                        var firstDiv = $(a).find('.star-rating').data('rating');
                        var secondDiv = $(b).find('.star-rating').data('rating');
                        return (firstDiv > secondDiv) ? -1 : (firstDiv < secondDiv) ? 1 : 0;
                    });
                    break;

                case '4'://по дешевым
                    //console.log('sortComments = по дешевым');
                    sortedComments = initialComments.sort(function (a, b) {
                        var firstDiv = parseInt($(a).find('.rate').text());
                        var secondDiv = parseInt($(b).find('.rate').text());
                        return (firstDiv > secondDiv) ? 1 : (firstDiv < secondDiv) ? -1 : 0;
                    });
                    break;

                case '5'://по дорогим
                    //console.log('sortComments = по дорогим');
                    sortedComments = initialComments.sort(function (a, b) {
                        var firstDiv = parseInt($(a).find('.rate').text());
                        var secondDiv = parseInt($(b).find('.rate').text());
                        return (firstDiv > secondDiv) ? -1 : (firstDiv < secondDiv) ? 1 : 0;
                    });
                    break;

                default://по новым (по умолчанию)
                    //console.log('sortComments = по новым');
                    sortedComments = initialComments.sort(function (a, b) {
                        var firstDiv = $(a).find('h6').text();
                        var secondDiv = $(b).find('h6').text();
                        return (firstDiv > secondDiv) ? -1 : (firstDiv < secondDiv) ? 1 : 0;
                    });
                    break;
            }
            $('#boxed-list-ul').append(sortedComments);
            $('#boxed-list-ul>li').css('background-color', 'transparent');
            $('#boxed-list-ul>li:odd').css('background-color', '#fafafa');
        });



        function RangeSlider() {
            // Thousand Separator
            function ThousandSeparator(nStr) {
                nStr += '';
                var x = nStr.split('.');
                var x1 = x[0];
                var x2 = x.length > 1 ? '.' + x[1] : '';
                var rgx = /(\d+)(\d{3})/;
                while (rgx.test(x1)) {
                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                }

                return x1 + x2;
            }

            // Bidding Slider Average Value
            var avgValue = (parseInt($('.bidding-slider').attr("data-slider-min")) + parseInt($('.bidding-slider').attr("data-slider-max"))) / 2;
            if ($('.bidding-slider').data("slider-value") === 'auto') {
                $('.bidding-slider').attr({ 'data-slider-value': avgValue });
            }

            // Bidding Slider Init
            $('.bidding-slider').slider();

            $(".bidding-slider").on("slide", function (slideEvt) {
                $("#add-offer-bidding-value").text(ThousandSeparator(parseInt(slideEvt.value)));
            });
            $(".bidding-slider").on("slide", function (slideEvt) {
                $("#edit-comment-bidding-value").text(ThousandSeparator(parseInt(slideEvt.value)));
            });
            $("#add-offer-bidding-value").text(ThousandSeparator(parseInt($('.bidding-slider').val())));

            $("#edit-comment-bidding-value").text(ThousandSeparator(parseInt($('.bidding-slider').val())));
            // Default Bootstrap Range Slider
            var currencyAttr = $(".range-slider").attr('data-slider-currency');

            $(".range-slider").slider({
                formatter: function (value) {
                    return currencyAttr + ThousandSeparator(parseInt(value[0])) + " - " + currencyAttr + ThousandSeparator(parseInt(value[1]));
                }
            });

            $(".range-slider-single").slider();

            $('#add-offer-slider-price').on('change', function () {
                $("#add-offer-price-value").val($("#add-offer-slider-price").val())
            });

            $('#edit-comment-slider-price').on('change', function () {
                $("#edit-comment-price-value").val($("#edit-comment-slider-price").val())
            });

            //alert($("#biddingVal").text())
            $("#add-offer-price-value").val = parseInt($("#add-offer-bidding-value").text());
            $("#edit-comment-price-value").val = parseInt($("#edit-comment-bidding-value").text());
        }

        // Snackbar for user status switcher
        $('#snackbar-user-status label').click(function () {
            Snackbar.show({
                text: 'Your status has been changed!',
                pos: 'bottom-center',
                showAction: false,
                actionText: "Dismiss",
                duration: 6000,
                textColor: '#fff',
                backgroundColor: '#383838'
            });
        });


        // Snackbar for copy to clipboard button
        $('.copy-url-button').click(function () {
            Snackbar.show({
                text: 'Copied to clipboard!',
            });
        });




        /**********************для поп-апа редактирования**********************/
        $('.selectpicker').selectpicker({
            liveSearch: true
        });

        $('.selectpicker-filter').selectpicker({
            liveSearch: false
        });


        $(function () {
            $('#datetimepicker3').datetimepicker(
                { format: 'HH:mm' }
            );

            $('#TaskList').change(function () {
                GetSkills();
            });

            function GetSkills() {
                var id = $('#TaskList').val();
                if (!id) {
                    id = 0;
                }
                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GetSkills", "User")/' + id,
                    dataType: 'JSON',
                    success: function (data) {
                        $('#SkillList').empty();
                        if (id != 0) {
                            $('#SkillList').attr('disabled',false);
                            $('#SkillList').append("<option value=''>Все предметы</option>");
                            $.each(data, function (i, item) {
                                $('#SkillList').append("<option value='" + item.Id + "'>" + item.Name + "</option>");
                            });
                        }
                        else {
                            $('#SkillList').append("<option value=''>Все предметы</option>");
                            $('#SkillList').attr("disabled", true);
                        }
                        $('#SkillList').selectpicker("refresh");
                    },
                    error: function (data) {
                        alert(data.responseText);
                    }
                });
            }


            $("#checkboxNew").click(function () {
                if ($(this).is(':checked')) {
                    $("#min").prop("disabled", true);
                    $("#min").css("background-color", "#f2f2f2");
                    $("#min").attr("placeholder", "");
                } else {
                    $("#min").prop("disabled", false);
                    $("#min").css("background-color", "#ffffff");
                    $("#min").attr("placeholder", "Цена");
                }
            });

        $("#checkboxDate").click(function () {
            if ($(this).is(':checked')) {
                $("#EndingDate").prop("disabled", true);
                $("#datetimepicker3").prop("disabled", true);
                $("#EndingDate").css("background-color", "#f2f2f2");
                $("#datetimepicker3").css("background-color", "#f2f2f2");
                $("#EndingDate").attr("placeholder", "");
                $("#EndingDate").val("");
                $("#datetimepicker3").attr("placeholder", "");
                $("#datetimepicker3").val("");

            } else {
                $("#EndingDate").prop("disabled", false);
                $("#datetimepicker3").prop("disabled", false);
                $("#EndingDate").css("background-color", "#ffffff");
                $("#datetimepicker3").css("background-color", "#ffffff");
                $("#EndingDate").attr("placeholder", "Дата сдачи");
                $("#datetimepicker3").attr("placeholder", "Время сдачи");
            }
        });


    });
    </script>
}

